{% extends "main.html" %}
{% block title %}Anodos: Каталог товаров и услуг{% endblock %}

{% block search %}
<li class="divider"></li>
<li class="has-form">
	<div class="row collapse">
		<div class="large-10 small-9 columns">
			<input id="top-search-input" type="text" placeholder="Поиск по складу..." value="{% if search %}{{ search }}{% endif %}">
		</div>
		<div class="large-2 small-3 columns">
			<button id="top-search-button" class="secondary expand"><i class="fa fa-search"></i></button>
		</div>
	</div>
</li>
{% endblock %}

{% block content %}
<!-- Фильтр вывода -->
<div class="row collapse">
	<ul class="button-group even-3">
		<li><button id="filter-items-category" data-do="open-filter-items-category"{% if category == None %} class="secondary"{% endif %}><i class="fa fa-folder-open-o"></i> Категория</button></li>
		<li><button id="filter-items-vendor" data-do="open-filter-items-vendor"{% if vendor == None %} class="secondary"{% endif %}><i class="fa fa-building"></i> Производитель</button></li>
		<li><button id="filter-items-search" data-do="open-filter-items-search"{% if not search %} class="secondary"{% endif %}><i class="fa fa-search"></i> Дополнительно</button></li>
	</ul>
</div>

<!-- Таблица со списком продуктов -->
<div class="row collapse">
	<table>
		<tr>
			<th class="text-center">#</th>
			<th class="text-center">Артикул</th>
			<th class="text-center">Наименование</th>
			<th class="text-center">Производитель</th>
			<th class="text-center">Цена</th>
			<th class="text-center">Количество</th>
		</tr>
		{% for product in products %}
		{% ifchanged product.category %}
		<tr><td colspan="6"><strong>{% if not product.category %}Без категории{% else %}{{ product.category.name }}{% endif %}</strong></td></tr>
		{% endifchanged %}
		<tr data-id="{{ product.id }}">
			<td>{{ product.n }}</td>
			<td>{{ product.article }}</td>
			<td style="word-break: break-all;"><a href="/catalog/product/{{ product.id }}/" data-do="edit-item" data-id="{{ product.id }}">{{ product.name }}</a></td>
			<td class="text-center"><a href="/catalog/vendor/{{ product.vendor.alias }}/">{{ product.vendor.name }}</a></td>
			<td style="white-space: nowrap;" class="text-right"><a data-do="view-parties" data-id="{{ product.id }}">{% autoescape off %}{{ product.price_out }}{% endautoescape %}</a></td>
			<td style="white-space: nowrap;"></td>
		</tr>
		{% endfor %}
	</table>

	<!-- Pagination -->
	{% if pages %}
	<div class="pagination-centered">
		<ul class="pagination">
			<li class="arrow{% if not page_prev %} unavailable{% endif %}"><a{% if page_prev %} href="{{ url }}{% if page_prev > 1 %}page/{{ page_prev }}/{% endif %}"{% endif %}>&laquo; Влево</a></li>
			{% for n in pages %}
				{% if n %}
				<li{% if page == n %} class="current"{% endif %}><a href="{{ url }}page/{{ n }}/">{{ n }}</a></li>
				{% else %}
				<li class="unavailable"><a>&hellip;</a></li>
				{% endif %}
			{% endfor %}
			<li class="arrow{% if not page_next %} unavailable{% endif %}"><a{% if page_next %} href="{{ url }}page/{{ page_next }}/"{% endif %}>Вправо &raquo;</a></li>
		</ul>
	</div>
	{% endif %}
</div>

<!-- Модальное окно фильтра -->
<div id="FilterItemsModal" class="reveal-modal large" data-reveal>

	<dl class="tabs" data-tab>
		<dd id="CategoryPanelDD" class="active"><a href="#CategoryPanel"><i class="fa fa-folder-open-o"></i> Категория</a></dd>
		<dd id="VendorPanelDD"><a href="#VendorPanel"><i class="fa fa-building"></i> Производитель</a></dd>
		<dd id="SearchPanelDD"><a href="#SearchPanel"><i class="fa fa-search"></i> Дополнительно</a></dd>
	</dl>
	<div class="tabs-content">
		<div class="content active" id="CategoryPanel">
			<p><span>Категория: </span><span id="filter-items-selected-category" data-id="{% if category != None %}{{ category.id }}{% endif %}">{% if category != None %}{{ category.name }}{% else %}Все категории{% endif %}</span>.</p>
			<ul class="inline-list">
				<li>
					<div class="switch tiny">
						<input id="filter-items-selected-childs" type="checkbox"{% if childs != 'n' %} checked{% endif %}>
						<label for="filter-items-selected-childs"></label>
					</div>
				</li>
				<li>
					<p>Включить дочерние категории.</p>
				</li>
			</ul>
			{% autoescape off %}{{ categories_ul }}{% endautoescape %}
		</div>
		<div class="content" id="VendorPanel">
			<p><span>Производитель: </span><span id="filter-items-selected-vendor" data-alias="{% if vendor != None %}{{ vendor.alias }}{% endif %}">{% if vendor != None %}{{ vendor.name }}{% else %}Все производители{% endif %}</span>.</p>
			<ul class="inline-list"><li><a data-do="filter-items-select-vendor" data-alias="">Все производители</a></li></ul>
			<div class="row">
				{% for vendor in vendors %}
				<div class="large-3 medium-6 small-12 columns">
				<a data-do="filter-items-select-vendor" data-alias="{{ vendor.alias }}">{{ vendor.name }}</a>
				</div>
				{% endfor %}
			</div>
		</div>
		<div class="content" id="SearchPanel">
			<label>Поисковый запрос
				<input id="filter-items-search-input" type="text" placeholder="Артикул, наименование или их часть..." value="{% if search %}{{ search }}{% endif %}">
			</label>
		</div>
	</div>

	<button data-do="filter-items-run">Применить</button>
	<button data-do="filter-items-cancel" class="secondary">Отмена</button>
</div>

{% if perms.catalog.change_product %}
<!-- Модальное окно редактирования элемента -->
<div id="EditItemModal" class="reveal-modal large" data-reveal>
	<h2>Редактировать продукт</h2>
	<fieldset>
		<input id="edit-item-id" type="hidden">
		<label>Наименование
			<input id="edit-item-name" type="text">
		</label>
		<label>Артикул
			<input id="edit-item-article" type="text">
		</label>
		<label>Производитель
			<select id="edit-item-vendor">
				{% for vendor in vendors %}
				<option value="{{ vendor.id }}">{{ vendor.name }}</option>
				{% endfor %}
			</select>
		</label>
		<label>Категория
			<select id="edit-item-category">
				<option value="null" selected> - Не определена - </option>
				{% for category in categories %}
				<option value="{{ category.id }}">{{ category.name }}</option>
				{% endfor %}
			</select>
		<label>Описание
			<textarea id="edit-item-description" type="text"></textarea>
		</label>
		<label>Дубль
			<input id="edit-item-double" type="text">
		</label>
		<label>Статус
			<div class="switch small">
				<input id="edit-item-state" type="checkbox">
				<label for="edit-item-state"></label>
			</div>
		</label>
	</fieldset>
	<button data-do="edit-item-save">Сохранить</button>
	<button data-do="edit-item-cancel" class="secondary">Отменить</button>
	<a class="close-reveal-modal">&#215;</a>
</div>
{% endif %}

<!-- TODO Включить проверку прав -->
<!-- Модальное окно просмотра партий  -->
<div id="ViewPartiesModal" class="reveal-modal" data-reveal>
	<h2>Партии продукта</h2>
	<div id="ViewPartiesModalContent"></div>
	<a class="close-reveal-modal">&#215;</a>
</div>

{% endblock %}
{% block js-content %}
<script>
{% include "catalog/js/products.js" %}
</script>
{% endblock %}
